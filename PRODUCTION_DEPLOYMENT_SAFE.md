# üöÄ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ–ø–ª–æ–π –ø–æ–∏—Å–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Elasticsearch

–≠—Ç–æ—Ç –¥–µ–ø–ª–æ–π –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–∏—Å–∫ **–ë–ï–ó –ø–æ—Ç–µ—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö** –≤ Elasticsearch. –í—Å–µ –≤–∞—à–∏ –∏–Ω–¥–µ–∫—Å—ã –∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.

## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ AI Service
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è `search_results` –≤ API
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ `watchlist` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç—Å—è:
- ‚ùå –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã Elasticsearch –ù–ï –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è
- ‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ES –ù–ï –º–µ–Ω—è–µ—Ç—Å—è
- ‚ùå –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Elasticsearch –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh –≤–∞—à-–ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä
cd /path/to/ai-service  # –ü—É—Ç—å –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

```bash
# 1. –ë—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp env.production env.production.backup.$(date +%Y%m%d_%H%M%S)

# 2. –ë—ç–∫–∞–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–∫–µ—Ä–∞
docker-compose ps > docker-state.backup.$(date +%Y%m%d_%H%M%S)

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è Elasticsearch –ü–ï–†–ï–î –¥–µ–ø–ª–æ–µ–º
curl -s http://localhost:9200/_cluster/health | jq .
curl -s http://localhost:9200/_cat/indices?v

# 4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–≤–æ–¥ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ü–û–°–õ–ï –¥–µ–ø–ª–æ—è
curl -s http://localhost:9200/_cat/indices?v > elasticsearch-indices.before.txt
```

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
git branch

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ commit 48c08d2
git log --oneline -5
```

### –®–∞–≥ 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la env.production.search

# –í–ê–ñ–ù–û: –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
echo "=== –¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==="
cat env.production | grep -E "(ENABLE_|ES_)" || echo "–ù–µ—Ç –ø–æ–∏—Å–∫–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"

echo "=== –ù–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==="
cat env.production.search | grep -E "(ENABLE_|ES_)"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp env.production.search env.production

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞"
```

### –®–∞–≥ 5: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps | grep ai

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¢–û–õ–¨–ö–û ai-service (Elasticsearch –ù–ï —Ç—Ä–æ–≥–∞–µ–º!)
docker-compose -f docker-compose.prod.yml stop ai-service

# –ù–ï –¥–µ–ª–∞—Ç—å docker-compose down - —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—å ES!

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
docker-compose -f docker-compose.prod.yml build --no-cache ai-service

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker-compose -f docker-compose.prod.yml up -d ai-service

echo "‚úÖ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

```bash
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã..."

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ AI Service –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
echo "=== AI SERVICE STATUS ==="
docker ps | grep ai-service
docker logs ai-service-prod --tail 20

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Elasticsearch –ù–ï –ø–æ—Å—Ç—Ä–∞–¥–∞–ª
echo "=== ELASTICSEARCH STATUS ==="
curl -s http://localhost:9200/_cluster/health | jq .

# 3. –°—Ä–∞–≤–Ω–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –î–û –∏ –ü–û–°–õ–ï
echo "=== ELASTICSEARCH INDICES ==="
curl -s http://localhost:9200/_cat/indices?v > elasticsearch-indices.after.txt
diff elasticsearch-indices.before.txt elasticsearch-indices.after.txt || echo "–ò–Ω–¥–µ–∫—Å—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∑–¥–æ—Ä–æ–≤—å–µ
echo "=== AI SERVICE HEALTH ==="
curl -s http://localhost:8000/health | jq .
```

### –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞

```bash
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏..."

# –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ search_results –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –æ—Ç–≤–µ—Ç–µ
echo "=== –¢–ï–°–¢ 1: –ü–æ–ª–µ search_results ==="
curl -s -X POST http://localhost:8000/process \
  -H "Content-Type: application/json" \
  -d '{"text": "–ü–æ—Ä–æ—à–µ–Ω–∫–æ –ü–µ—Ç—Ä", "generate_variants": false}' \
  | jq 'keys[]' | grep search_results

if [ $? -eq 0 ]; then
    echo "‚úÖ –ü–æ–ª–µ search_results –Ω–∞–π–¥–µ–Ω–æ"
else
    echo "‚ùå –ü–æ–ª–µ search_results –ù–ï –Ω–∞–π–¥–µ–Ω–æ!"
fi

# –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É search_results
echo "=== –¢–ï–°–¢ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ search_results ==="
curl -s -X POST http://localhost:8000/process \
  -H "Content-Type: application/json" \
  -d '{"text": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω", "generate_variants": false}' \
  | jq '.search_results'

# –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
echo "=== –¢–ï–°–¢ 3: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ==="
curl -s -X POST http://localhost:8000/process \
  -H "Content-Type: application/json" \
  -d '{"text": "–ü–æ—Ä–æ—à–µ–Ω–∫–∞ –ü–µ—Ç–µ–Ω—å–∫–∞", "generate_variants": false}' \
  | jq -r '.normalized_text'
```

### –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Elasticsearch (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É ES –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Elasticsearch..."

cd scripts
python3 setup_elasticsearch.py
cd ..

echo "‚úÖ Elasticsearch –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
```

## üîç –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π:

1. **AI Service —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   ```bash
   curl http://localhost:8000/health
   # Status: 200, "status": "healthy"
   ```

2. **search_results –≤ –æ—Ç–≤–µ—Ç–µ**:
   ```json
   {
     "normalized_text": "–ü–æ—Ä–æ—à–µ–Ω–∫–æ –ü–µ—Ç—Ä",
     "search_results": {
       "query": "–ü–æ—Ä–æ—à–µ–Ω–∫–æ –ü–µ—Ç—Ä",
       "results": [],
       "total_hits": 0,
       "search_type": "similarity_mock"
     }
   }
   ```

3. **Elasticsearch –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª**:
   ```bash
   curl http://localhost:9200/_cluster/health
   # "status": "green" –∏–ª–∏ "yellow"
   ```

4. **–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã**:
   ```bash
   curl http://localhost:9200/_cat/indices
   # –í—Å–µ –≤–∞—à–∏ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –º–µ—Å—Ç–µ + –≤–æ–∑–º–æ–∂–Ω–æ –Ω–æ–≤—ã–π "watchlist"
   ```

## üö® –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
# –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp env.production.backup.YYYYMMDD_HHMMSS env.production

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
docker-compose -f docker-compose.prod.yml restart ai-service

echo "‚úÖ –û—Ç–∫–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω"
```

### –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç –∫–æ–¥–∞:
```bash
# –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard d01bbf8  # –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.prod.yml stop ai-service
docker-compose -f docker-compose.prod.yml build --no-cache ai-service
docker-compose -f docker-compose.prod.yml up -d ai-service

echo "‚úÖ –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –í —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —á–∞—Å–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

```bash
# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏
watch -n 300 'docker logs ai-service-prod --tail 10'

# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:8000/process \
  -d '{"text":"test"}'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å Elasticsearch
watch -n 300 'curl -s http://localhost:9200/_cluster/health | jq .'
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

- [ ] –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] AI Service –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
- [ ] `search_results` –ø–æ–ª–µ –ø–æ—è–≤–∏–ª–æ—Å—å –≤ API –æ—Ç–≤–µ—Ç–∞—Ö
- [ ] Elasticsearch –∑–¥–æ—Ä–æ–≤ (—Å—Ç–∞—Ç—É—Å green/yellow)
- [ ] –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [ ] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ (<100ms –Ω–∞ –∑–∞–ø—Ä–æ—Å)

## üéâ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

–ü–æ–∏—Å–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ mock service —Å –ø—É—Å—Ç—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ watchlist –∏–Ω–¥–µ–∫—Å.

**–î–µ–ø–ª–æ–π –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ Elasticsearch!** üîí