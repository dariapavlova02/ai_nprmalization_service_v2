# Детальный отчет Golden Parity Test

## Общая статистика

- **Всего кейсов**: 31
- **Parity (совпадение legacy vs factory)**: 64.5% (20 из 31)
- **Legacy производительность**: p95=0.0046s, p99=0.0103s
- **Factory производительность**: p95=0.0032s, p99=0.0090s

## Критические проблемы (7 кейсов не прошли MATCH)

### 1. ru_declension_to_nominative
- **Вход**: `платёж Ивану Петрову`
- **Legacy**: `Иван Петров` ✅ (правильно)
- **Factory**: `Ивану Петрову` ❌ (не склоняет в именительный падеж)
- **Ожидаемое**: `Иван Петров`
- **Проблема**: Factory не применяет склонение в именительный падеж

### 2. ru_diminutive
- **Вход**: `Сашка Пушкин`
- **Legacy**: `Сашка Пушкин` ❌ (не расшифровывает уменьшительное)
- **Factory**: `Александр Пушкин` ✅ (правильно)
- **Ожидаемое**: `Александр Пушкин`
- **Проблема**: Legacy не обрабатывает уменьшительные имена

### 3. uk_diminutive
- **Вход**: `Петрик Шевченко`
- **Legacy**: `Петрик Шевченко` ❌ (не расшифровывает уменьшительное)
- **Factory**: `Петро Шевченко` ✅ (правильно)
- **Ожидаемое**: `Петро Шевченко`
- **Проблема**: Legacy не обрабатывает украинские уменьшительные имена

### 4. en_title_suffix
- **Вход**: `Dr. John A. Smith Jr.`
- **Legacy**: `John A. Smith` ❌ (убирает титулы, но оставляет инициалы)
- **Factory**: `Dr. John A. Smith Jr.` ❌ (не убирает титулы и суффиксы)
- **Ожидаемое**: `John Smith`
- **Проблема**: Оба сервиса неправильно обрабатывают английские титулы и суффиксы

### 5. en_nickname
- **Вход**: `Bill Gates`
- **Legacy**: `Gates` ❌ (убирает имя, оставляет только фамилию)
- **Factory**: `Bill Gates` ❌ (не расшифровывает никнейм)
- **Ожидаемое**: `William Gates`
- **Проблема**: Оба сервиса неправильно обрабатывают английские никнеймы

### 6. en_apostrophe
- **Вход**: `O'Connor, Sean`
- **Legacy**: `Sean` ❌ (убирает фамилию с апострофом)
- **Factory**: `O Connor , Sean` ❌ (неправильно обрабатывает апостроф и запятую)
- **Ожидаемое**: `Sean O'Connor`
- **Проблема**: Оба сервиса неправильно обрабатывают апострофы в английских именах

### 7. en_double_surname
- **Вход**: `Emily Blunt-Krasinski`
- **Legacy**: `Emily` ❌ (убирает фамилию)
- **Factory**: `Emily Blunt Krasinski` ❌ (убирает дефис)
- **Ожидаемое**: `Emily Blunt-Krasinski`
- **Проблема**: Оба сервиса неправильно обрабатывают двойные фамилии

## Дополнительные проблемы (4 кейса)

### 8. ru_context_words
- **Вход**: `получатель: гражданин РФ Петр Сергеев`
- **Legacy**: `Гражданин Пётр Сергеев` ❌ (включает контекстные слова)
- **Factory**: `Гражданин Петр Сергеев` ❌ (включает контекстные слова)
- **Ожидаемое**: `Петр Сергеев`
- **Проблема**: Оба сервиса не фильтруют контекстные слова

### 9. mixed_org_noise
- **Вход**: `Оплата ТОВ "ПРИВАТБАНК" Ивану Петрову, 1980-01-01`
- **Legacy**: `Ивану Петрова` ❌ (неправильное склонение)
- **Factory**: `Ивану Петрову` ❌ (не склоняет в именительный падеж)
- **Ожидаемое**: `Іван Петров`
- **Проблема**: Оба сервиса не фильтруют организационные данные и не склоняют правильно

### 10. mixed_diacritics
- **Вход**: `Café José → оплата Івану`
- **Legacy**: `Café José Іван` ❌ (включает нерелевантные имена)
- **Factory**: `Café José Івану` ❌ (включает нерелевантные имена)
- **Ожидаемое**: `Іван`
- **Проблема**: Оба сервиса не фильтруют нерелевантные имена в смешанном контексте

### 11. behavior_idempotent
- **Вход**: `Петр Сергеев`
- **Legacy**: `Пётр Сергеев` ❌ (меняет написание)
- **Factory**: `Петр Сергеев` ✅ (сохраняет оригинальное написание)
- **Ожидаемое**: `Петр Сергеев`
- **Проблема**: Legacy изменяет написание имен без необходимости

## Анализ производительности

### Legacy Service
- **Среднее время**: ~1.2ms
- **p95**: 4.6ms
- **p99**: 10.3ms
- **Максимум**: 7.3ms (ru_basic_full)

### Factory Service
- **Среднее время**: ~0.4ms
- **p95**: 3.2ms
- **p99**: 9.0ms
- **Максимум**: 5.9ms (en_title_suffix)

**Вывод**: Factory сервис в среднем в 3 раза быстрее Legacy сервиса.

## Рекомендации по исправлению

### Приоритет 1: Критические кейсы
1. **ru_declension_to_nominative**: Добавить склонение в именительный падеж в Factory
2. **ru_diminutive/uk_diminutive**: Исправить обработку уменьшительных в Legacy
3. **en_title_suffix**: Исправить обработку титулов и суффиксов в обоих сервисах
4. **en_nickname**: Добавить расшифровку никнеймов в оба сервиса
5. **en_apostrophe**: Исправить обработку апострофов в обоих сервисах
6. **en_double_surname**: Исправить обработку двойных фамилий в обоих сервисах

### Приоритет 2: Дополнительные проблемы
1. **ru_context_words**: Добавить фильтрацию контекстных слов
2. **mixed_org_noise**: Улучшить фильтрацию организационных данных
3. **mixed_diacritics**: Улучшить фильтрацию нерелевантных имен
4. **behavior_idempotent**: Исправить идемпотентность в Legacy

### Приоритет 3: Оптимизация
1. Factory сервис уже показывает лучшую производительность
2. Legacy сервис требует оптимизации для критических кейсов

## Заключение

Текущий parity составляет 64.5%, что ниже требуемых 90%. Основные проблемы связаны с:

1. **Неполной реализацией функций** в Legacy сервисе (уменьшительные имена)
2. **Отсутствием склонения** в Factory сервисе
3. **Неправильной обработкой английских имен** в обоих сервисах
4. **Недостаточной фильтрацией** контекстных слов и шума

Для достижения 100% parity необходимо исправить все критические кейсы, особенно те, которые указаны в фикс-паке.
