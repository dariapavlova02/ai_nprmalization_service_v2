# –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è AI Service Normalization Factory

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ factory-–ø—É—Ç–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

## üéØ –¶–µ–ª—å

–ü—Ä–æ–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞—Ç—å factory-–ø—É—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö –∏ –Ω–∞–π—Ç–∏ "–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏" –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏/–∫–æ–ø–∏–∏ —Å—Ç—Ä–æ–∫
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –º–æ—Ä—Ñ-–ø–∞—Ä—Å—ã –∏ —Ç–æ–∫–µ–Ω-–∫–ª–∞—Å—Å—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
make -f Makefile.profile install-profile-deps
```

### 2. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

```bash
python scripts/demo_profiling.py
```

### 3. –ü–æ–ª–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
make -f Makefile.profile profile
```

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
make -f Makefile.profile show-profile
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
scripts/
‚îú‚îÄ‚îÄ profile_normalization.py          # cProfile + pstats –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ profile_normalization_pyinstrument.py  # pyinstrument HTML-–æ—Ç—á—ë—Ç—ã
‚îú‚îÄ‚îÄ generate_profile_report.py        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è markdown-–æ—Ç—á—ë—Ç–∞
‚îú‚îÄ‚îÄ test_profiling.py                 # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
‚îî‚îÄ‚îÄ demo_profiling.py                 # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

src/ai_service/utils/
‚îî‚îÄ‚îÄ profiling.py                      # –£—Ç–∏–ª–∏—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

docs/
‚îî‚îÄ‚îÄ PROFILING_README.md               # –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

artifacts/                            # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ profile_stats.prof               # cProfile –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ profile_async.html               # pyinstrument HTML (async)
‚îú‚îÄ‚îÄ profile_sync.html                # pyinstrument HTML (sync)
‚îú‚îÄ‚îÄ profile_detail_*.html            # –î–µ—Ç–∞–ª—å–Ω—ã–µ HTML-–æ—Ç—á—ë—Ç—ã
‚îî‚îÄ‚îÄ profile_report.md                # Markdown-–æ—Ç—á—ë—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

#### `profile_normalization.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å cProfile + pstats
- **–í—ã—Ö–æ–¥**: TOP-50 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ cumtime/tottime
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `python scripts/profile_normalization.py [iterations]`

#### `profile_normalization_pyinstrument.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω—ã–µ HTML-–æ—Ç—á—ë—Ç—ã —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–í—ã—Ö–æ–¥**: `artifacts/profile_*.html`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `python scripts/profile_normalization_pyinstrument.py [iterations]`

#### `generate_profile_report.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- **–í—ã—Ö–æ–¥**: `artifacts/profile_report.md`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `python scripts/generate_profile_report.py`

### 2. –£—Ç–∏–ª–∏—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è (`profiling.py`)

#### `PerformanceCounter`
- –î–µ—à—ë–≤—ã–π —Å—á—ë—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ú–µ—Ç—Ä–∏–∫–∏: p50, p95, p99, —Å—Ä–µ–¥–Ω–µ–µ, –º–∏–Ω–∏–º—É–º, –º–∞–∫—Å–∏–º—É–º
- Thread-safe –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

#### `MemoryTracker`
- –¢—Ä–µ–∫–∏–Ω–≥ –ø–∞–º—è—Ç–∏ —Å tracemalloc
- –ü–∏–∫–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –∞–ª–ª–æ–∫–∞—Ü–∏–∏, —Å–Ω–∏–º–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏

#### `ProfilingManager`
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ —Å–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö

#### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
```python
@profile_function("component.method")
async def method():
    pass

with profile_time("operation"):
    # –∫–æ–¥

with profile_memory("allocation"):
    # –∫–æ–¥
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–µ—Ä–≤–∏—Å—ã

–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **`TokenProcessor.strip_noise_and_tokenize`** - —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
- **`MorphologyProcessor.normalize_slavic_token`** - –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è
- **`RoleClassifier.tag_tokens`** - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–æ–ª–µ–π
- **`NormalizationFactory.normalize_text`** - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∏–∑ 20 —Ñ—Ä–∞–∑:

### –†—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞
- "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
- "–û–û–û '–†–æ–º–∞—à–∫–∞' –ò–≤–∞–Ω –ò."
- "–ê–Ω–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞"
- "–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á –ü–µ—Ç—Ä–æ–≤"
- "–ú–∞—Ä–∏—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞"

### –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –∏–º–µ–Ω–∞
- "–ü–µ—Ç—Ä–æ –ü–æ—Ä–æ—à–µ–Ω–∫–æ"
- "–í–æ–ª–æ–¥–∏–º–∏—Ä –ó–µ–ª–µ–Ω—Å—å–∫–∏–π"
- "–û–ª–µ–Ω–∞ –ü—ñ–¥–¥—É–±–Ω–∞"
- "–¢–û–í '–ö–∏—ó–≤' –û–ª–µ–∫—Å–∞–Ω–¥—Ä –û."
- "–ù–∞—Ç–∞–ª—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞ –ö–æ–≤–∞–ª–µ–Ω–∫–æ"

### –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞
- "John Smith"
- "Mary Johnson"
- "Robert Brown"
- "Elizabeth Davis"
- "Michael Wilson"

### –°–º–µ—à–∞–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏
- "Dr. John Smith"
- "Prof. Maria Garcia"
- "Mr. –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤"
- "Ms. –ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞"
- "–Ü–≤–∞–Ω I. –ü–µ—Ç—Ä–æ–≤"

## üéØ –¢–∏–ø—ã –≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫

### 1. Tokenization (—Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è)
- **–°–∏–º–ø—Ç–æ–º—ã**: –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –≤ `strip_noise_and_tokenize`
- **–ü—Ä–∏—á–∏–Ω—ã**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ regex, split() –≤ —Ü–∏–∫–ª–∞—Ö
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ü—Ä–µ–¥–∫–æ–º–ø–∏–ª—è—Ü–∏—è regex, –±–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 2. Morphology (–º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è)
- **–°–∏–º–ø—Ç–æ–º—ã**: –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –≤ `normalize_slavic_token`
- **–ü—Ä–∏—á–∏–Ω—ã**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã pymorphy3
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: LRU –∫—ç—à, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 3. Role Classification (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–æ–ª–µ–π)
- **–°–∏–º–ø—Ç–æ–º—ã**: –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –≤ `tag_tokens`
- **–ü—Ä–∏—á–∏–Ω—ã**: –õ–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫ –≤ —Å–ª–æ–≤–∞—Ä—è—Ö
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: Set –≤–º–µ—Å—Ç–æ list, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### 4. Normalization (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)
- **–°–∏–º–ø—Ç–æ–º—ã**: –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –≤ `normalize_text`
- **–ü—Ä–∏—á–∏–Ω—ã**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

### 5. Regex (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è)
- **–°–∏–º–ø—Ç–æ–º—ã**: –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –≤ regex —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **–ü—Ä–∏—á–∏–Ω—ã**: –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ü—Ä–µ–¥–∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

```python
from functools import lru_cache

@lru_cache(maxsize=1000)
def _morph_nominal_cached(token: str, language: str) -> str:
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
    pass
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: -30-50% –≤—Ä–µ–º–µ–Ω–∏

### 2. –ü—Ä–µ–¥–∫–æ–º–ø–∏–ª—è—Ü–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π

```python
import re

# –ù–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è
TOKEN_SPLIT_PATTERN = re.compile(r"([,])")
INITIALS_PATTERN = re.compile(r"^((?:[A-Za-z–ê-–Ø–∞-—è–Ü–á–Ñ“ê—ñ—ó—î“ë]\.){2,})([A-Za-z–ê-–Ø–∞-—è–Ü–á–Ñ“ê—ñ—ó—î“ë].*)$")
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: -10-20% –≤—Ä–µ–º–µ–Ω–∏

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≤ —Å–ª–æ–≤–∞—Ä—è—Ö

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å set –≤–º–µ—Å—Ç–æ list –¥–ª—è O(1) –ø–æ–∏—Å–∫–∞
STOP_WORDS_SET = set(STOP_ALL)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: -5-15% –≤—Ä–µ–º–µ–Ω–∏

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–æ–ª–µ–π

```python
from functools import lru_cache

@lru_cache(maxsize=500)
def _classify_token_cached(token: str, language: str) -> str:
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–æ–ª–∏
    pass
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: -20-40% –≤—Ä–µ–º–µ–Ω–∏

## üõ† –ö–æ–º–∞–Ω–¥—ã Makefile

```bash
# –ü–æ–ª–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
make -f Makefile.profile profile

# –¢–æ–ª—å–∫–æ cProfile
make -f Makefile.profile profile-cprofile

# –¢–æ–ª—å–∫–æ pyinstrument
make -f Makefile.profile profile-pyinstrument

# –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
make -f Makefile.profile profile-quick

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–∞–º—è—Ç—å—é
make -f Makefile.profile profile-memory

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞
make -f Makefile.profile profile-report

# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
make -f Makefile.profile show-profile

# –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
make -f Makefile.profile clean-profile

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make -f Makefile.profile install-profile-deps
```

## üìã –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

- ‚úÖ –ï—Å—Ç—å –¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è; –ª–æ–∫–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ ES/—Å–µ—Ç–µ–π
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ç—Å—è `artifacts/profile.html` –∏ `artifacts/profile_report.md`
- ‚úÖ –í –æ—Ç—á—ë—Ç–µ —è–≤–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã 3‚Äì5 –≥–æ—Ä—è—á–∏—Ö –º–µ—Å—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ª–æ–º–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç `NormalizationResult`
- ‚úÖ –ü—É—Ç—å legacy –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–∞–π–¥-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤: –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `scripts/*`

## üîç –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### HTML-–æ—Ç—á—ë—Ç—ã pyinstrument
1. –û—Ç–∫—Ä–æ–π—Ç–µ `artifacts/profile_async.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ò–∑—É—á–∏—Ç–µ flame graph –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ call stack
3. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. –ò—â–∏—Ç–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏

### Markdown-–æ—Ç—á—ë—Ç
1. –û—Ç–∫—Ä–æ–π—Ç–µ `artifacts/profile_report.md`
2. –ò–∑—É—á–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É TOP-10 –≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫
3. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. –°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ (high/medium/low priority)

## üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ production
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è** - –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
3. **–ü–∞–º—è—Ç—å** - pyinstrument –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## üîß Troubleshooting

### –û—à–∏–±–∫–∞ "pyinstrument –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
```bash
pip install pyinstrument
```

### –û—à–∏–±–∫–∞ "ModuleNotFoundError"
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/ai-service
python scripts/profile_normalization.py
```

### –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
make -f Makefile.profile clean-profile
make -f Makefile.profile profile
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/PROFILING_README.md)
- [cProfile –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python.org/3/library/profile.html)
- [pyinstrument –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pyinstrument.readthedocs.io/)
- [Python profiling best practices](https://docs.python.org/3/library/profile.html#profile-stats)

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

1. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** —Å –ø–æ–º–æ—â—å—é cProfile –∏ pyinstrument
2. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ API
4. **–£–¥–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python scripts/demo_profiling.py` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π!
