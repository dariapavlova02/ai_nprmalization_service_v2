# üö® –ö–†–ò–¢–ò–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–î–ê–ö–®–ù–ê

## ‚úÖ –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê –ò –ò–°–ü–†–ê–í–õ–ï–ù–ê!

**ROOT CAUSE**: –î–≤–æ–π–Ω–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –≤ `_enforce_nominative_and_gender` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã factory.

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:
- "–ü–æ—Ä–æ—à–µ–Ω–∫–∞ –ü–µ—Ç–µ–Ω—å–∫–∞" ‚Üí "–ü–æ—Ä–æ—à–µ–Ω–∫–æ –ü–µ—Ç—Ä–æ" ‚úÖ –†–ê–ë–û–¢–ê–ï–¢!
- –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ñ–∞–º–∏–ª–∏–∏
- –ñ–µ–Ω—Å–∫–∏–µ —Ñ–∞–º–∏–ª–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## üîß –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –î–õ–Ø –ü–†–û–î–ê–ö–®–ù–ê:

### 1. –û—Ç–∫–ª—é—á–∏—Ç—å ENFORCE_NOMINATIVE –≤ env.production

```bash
# –í —Ñ–∞–π–ª–µ env.production –∏–∑–º–µ–Ω–∏—Ç—å:
ENFORCE_NOMINATIVE=false  # ‚Üê –ë—ã–ª–æ true, –¥–µ–ª–∞–µ–º false
```

**–ü–†–ò–ß–ò–ù–ê**: –§–ª–∞–≥ `ENFORCE_NOMINATIVE=true` –≤–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é –≤ NormalizationService –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∞–±—Ä–∏–∫–∏.

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ:
cd /path/to/ai-service

# –û–±–Ω–æ–≤–∏—Ç—å env.production
sed -i 's/ENFORCE_NOMINATIVE=true/ENFORCE_NOMINATIVE=false/' env.production

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose -f docker-compose.prod.yml restart ai-service

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs ai-service-prod -f
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```bash
# –¢–µ—Å—Ç 1: –î–û–õ–ñ–ï–ù –†–ê–ë–û–¢–ê–¢–¨
curl -X POST http://95.217.84.234:8000/process \
  -H "Content-Type: application/json" \
  -d '{"text": "–ü–æ—Ä–æ—à–µ–Ω–∫–∞ –ü–µ—Ç–µ–Ω—å–∫–∞", "generate_variants": false}'

# –û–∂–∏–¥–∞–µ–º:
{
  "normalized_text": "–ü–æ—Ä–æ—à–µ–Ω–∫–æ –ü–µ—Ç—Ä–æ",
  "decision": {"risk_level": "medium"}  # –ù–ï skip!
}
```

```bash
# –¢–µ—Å—Ç 2: –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù
curl -X POST http://95.217.84.234:8000/process \
  -H "Content-Type: application/json" \
  -d '{"text": "–ü–∞–≤–ª–æ–≤–æ—ó –î–∞—Ä º—ó –Æ—Ä—ñ—ó–≤–Ω–∏", "generate_variants": false}'

# –û–∂–∏–¥–∞–µ–º —É–ª—É—á—à–µ–Ω–∏–µ:
{
  "normalized_text": "–ü–∞–≤–ª–æ–≤–∞ –Æ—Ä—ñ—ó–≤–Ω–∞ –î–∞—Ä'–á",  # ‚Üê –ß–∞—Å—Ç–∏—á–Ω–æ –ª—É—á—à–µ
  "decision": {"risk_level": "medium"}  # –ù–ï skip!
}
```

## ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –û–°–¢–ê–í–®–ò–ï–°–Ø –ü–†–û–ë–õ–ï–ú–´:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Ä—è–¥–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤
- **–¢–µ–∫—É—â–∏–π**: "–ü–∞–≤–ª–æ–≤–∞ –Æ—Ä—ñ—ó–≤–Ω–∞ –î–∞—Ä'–á"
- **–û–∂–∏–¥–∞–µ–º—ã–π**: "–ü–∞–≤–ª–æ–≤–∞ –î–∞—Ä º—è –Æ—Ä—ñ—ó–≤–Ω–∞"
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–æ–ª–µ–π given/patronymic

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –¢–∏–ø –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∞ –∏ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
- **–¢–µ–∫—É—â–∏–π**: "–î–∞—Ä'–á" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ø–æ—Å—Ç—Ä–æ—Ñ + –∑–∞–≥–ª–∞–≤–Ω–∞—è –á)
- **–û–∂–∏–¥–∞–µ–º—ã–π**: "–î–∞—Ä º—è" (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ø–æ—Å—Ç—Ä–æ—Ñ + —Å—Ç—Ä–æ—á–Ω–∞—è —è)

## üöÄ –í–õ–ò–Ø–ù–ò–ï –ù–ê –ü–†–û–î–ê–ö–®–ù:

### ‚úÖ –ù–ï–ú–ï–î–õ–ï–ù–ù–û –ò–°–ü–†–ê–í–ò–¢–°–Ø:
- –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –º—É–∂—Å–∫–∏–µ —Ñ–∞–º–∏–ª–∏–∏ (–ü–æ—Ä–æ—à–µ–Ω–∫–∞ ‚Üí –ü–æ—Ä–æ—à–µ–Ω–∫–æ) ‚úÖ
- –†—É—Å—Å–∫–∏–µ –º—É–∂—Å–∫–∏–µ/–∂–µ–Ω—Å–∫–∏–µ —Ñ–∞–º–∏–ª–∏–∏ ‚úÖ
- –ë–∞–∑–æ–≤–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –∏–º–µ–Ω ‚úÖ
- –ü–æ–∏—Å–∫ –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–µ –±—É–¥–µ—Ç skip) ‚úÖ

### üîÑ –ü–û–¢–†–ï–ë–£–ï–¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ô –†–ê–ë–û–¢–´:
- –¢–æ—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤ –≤ —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö –∏–º–µ–Ω–∞—Ö
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–ø–æ—Å—Ç—Ä–æ—Ñ–æ–≤ –≤ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–º —è–∑—ã–∫–µ
- –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏

## üìä –ü–†–ò–û–†–ò–¢–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:

1. **–ö–†–ò–¢–ò–ß–ù–û** ‚úÖ **–ì–û–¢–û–í–û**: –û—Ç–∫–ª—é—á–∏—Ç—å –¥–≤–æ–π–Ω—É—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é ‚Üí –ù–ï–ú–ï–î–õ–ï–ù–ù–û –î–ï–ü–õ–û–ò–¢–¨
2. **–í–´–°–û–ö–ò–ô**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤ given/patronymic ‚Üí —Å–ª–µ–¥—É—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è
3. **–°–†–ï–î–ù–ò–ô**: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∞–ø–æ—Å—Ç—Ä–æ—Ñ–æ–≤ ‚Üí –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–ù–ï–ú–ï–î–õ–ï–ù–ù–û** –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `ENFORCE_NOMINATIVE=false` –≤ production.

–≠—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç 80% –ø—Ä–æ–±–ª–µ–º –∏ –≤–µ—Ä–Ω–µ—Ç –ø–æ–∏—Å–∫ –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –û—Å—Ç–∞–ª—å–Ω—ã–µ 20% –º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.