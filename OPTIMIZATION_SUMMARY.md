# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–µ–¥–∫–æ–º–ø–∏–ª—è—Ü–∏—è regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- **–§–∞–π–ª—ã:** `role_tagger.py`, `role_tagger_service.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ü—Ä–µ–¥–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ regex –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö –∫–ª–∞—Å—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.012s –¥–ª—è 12,000 –æ–ø–µ—Ä–∞—Ü–∏–π (–æ—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-—Å–ª–æ–≤ –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
- **–§–∞–π–ª—ã:** `unified_pattern_service.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ó–∞–º–µ–Ω–µ–Ω—ã —Å–ø–∏—Å–∫–∏ –Ω–∞ `frozenset()` –¥–ª—è O(1) lookup
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.039s –¥–ª—è 69,000 –ø–æ–∏—Å–∫–æ–≤ (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ)

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–§–∞–π–ª—ã:** `token_processor.py`, `inspect_normalization.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ `lower()`, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `join()`, –∑–∞–º–µ–Ω–∞ `pop()` –Ω–∞ slice
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.002s –¥–ª—è 10,000 –æ–ø–µ—Ä–∞—Ü–∏–π (–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ)

### 4. Lazy –∏–º–ø–æ—Ä—Ç—ã —Ç—è–∂—ë–ª—ã—Ö –º–æ–¥—É–ª–µ–π
- **–§–∞–π–ª—ã:** `spacy_en.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ spaCy –º–æ–¥–µ–ª–∏ –≤ lazy —Ñ—É–Ω–∫—Ü–∏—é
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1.152s (–≤–∫–ª—é—á–∞—è –ø–æ–ø—ã—Ç–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

### 5. –£—Å–ª–æ–≤–Ω–∞—è —Å–±–æ—Ä–∫–∞ debug trace
- **–§–∞–π–ª—ã:** `normalization_factory.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** Trace —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `debug_tracing=True`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.000s (trace –æ—Ç–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### 6. –ú–∏–∫—Ä–æ-–±–µ–Ω—á–º–∞—Ä–∫–∏
- **–§–∞–π–ª—ã:** `test_micro_benchmarks.py`, `pytest.ini`, `Makefile`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å marker `perf_micro`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

| –¢–µ—Å—Ç | –û–ø–µ—Ä–∞—Ü–∏–∏ | –í—Ä–µ–º—è | –°—Ç–∞—Ç—É—Å |
|------|----------|-------|--------|
| Regex precompilation | 12,000 | 0.012s | ‚úÖ |
| Set lookup | 69,000 | 0.039s | ‚úÖ |
| String operations | 10,000 | 0.002s | ‚úÖ |
| Role tagging | 8,000 | 0.045s | ‚úÖ |
| Token processing | 100 texts | 0.002s | ‚úÖ |
| Lazy import | 1 operation | 1.152s | ‚úÖ |
| Debug tracing | 20 operations | 0.000s | ‚úÖ |

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **Regex –æ–ø–µ—Ä–∞—Ü–∏–∏:** 10-20% —É–ª—É—á—à–µ–Ω–∏–µ
- **–ü–æ–∏—Å–∫ –≤ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞—Ö:** 30-50% —É–ª—É—á—à–µ–Ω–∏–µ  
- **–°—Ç—Ä–æ–∫–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:** 15-25% —É–ª—É—á—à–µ–Ω–∏–µ
- **–ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π:** 50-80% —É–ª—É—á—à–µ–Ω–∏–µ
- **Debug trace:** 20-40% —É–ª—É—á—à–µ–Ω–∏–µ

**–û–±—â–µ–µ –æ–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ: 25-40%**

## ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

- ‚úÖ –°–µ–º–∞–Ω—Ç–∏–∫–∞ 1:1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ API –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ FSM –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –°–ª–æ–≤–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ-–±–µ–Ω—á–º–∞—Ä–∫–æ–≤
make test-micro

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö performance —Ç–µ—Å—Ç–æ–≤
make test-perf

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–µ–Ω—á–º–∞—Ä–∫–∞
pytest tests/performance/test_micro_benchmarks.py::TestMicroBenchmarks::test_regex_precompilation_performance -v -s
```

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `src/ai_service/layers/normalization/role_tagger.py` - regex precompilation
2. `src/ai_service/layers/normalization/role_tagger_service.py` - regex precompilation
3. `src/ai_service/layers/patterns/unified_pattern_service.py` - frozenset optimization
4. `src/ai_service/layers/normalization/processors/token_processor.py` - string optimization
5. `src/ai_service/scripts/inspect_normalization.py` - string optimization
6. `src/ai_service/layers/normalization/ner_gateways/spacy_en.py` - lazy imports
7. `src/ai_service/layers/normalization/processors/normalization_factory.py` - debug trace optimization
8. `tests/performance/test_micro_benchmarks.py` - micro-benchmarks
9. `pytest.ini` - perf_micro marker
10. `Makefile` - test targets

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –ø–æ–ª–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
