[1m============================= test session starts ==============================[0m
platform darwin -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/dariapavlova/Desktop/ai-service
configfile: pytest.ini
testpaths: tests
plugins: asyncio-1.2.0, timeout-2.4.0, anyio-4.10.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
timeout: 300.0s
timeout method: signal
timeout func_only: False
collected 1834 items / 1682 deselected / 152 selected

tests/integration/test_lang_order_unicode_first.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m               [  4%][0m
tests/integration/test_normalization_pipeline.py [31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[31mF[0m[31mF[0m[32m.[0m[31mF[0m[31mF[0m[32m.[0m[31m             [ 11%][0m
tests/integration/test_orchestrator_decision_integration.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m     [ 17%][0m
tests/unit/api/test_main_endpoints.py [32m.[0m[32m.[0m[32m.[0m[31m                                [ 19%][0m
tests/unit/core/test_orchestrator_factory.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                [ 26%][0m
tests/unit/monitoring/test_metrics_basic.py [31mF[0m[31m                            [ 27%][0m
tests/unit/monitoring/test_orchestrator_metrics.py [31mF[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[31mF[0m[31m         [ 36%][0m
tests/unit/morphology/test_integration_morphology.py [33ms[0m[31m                   [ 36%][0m
tests/unit/screening/test_smart_filter_service.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m       [ 47%][0m
tests/unit/smart_filter/test_smart_filter_service_async.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m      [ 52%][0m
tests/unit/test_integration_morphology.py [32m.[0m[31m                              [ 53%][0m
tests/unit/test_orchestrator_service.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                          [ 57%][0m
tests/unit/test_orchestrator_service_fixed.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                    [ 62%][0m
tests/unit/test_orchestrator_service_old.py [31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[31mF[0m[31m        [ 76%][0m
tests/unit/test_smart_filter_service.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                 [ 86%][0m
tests/unit/test_unified_orchestrator.py [31mF[0m[31mF[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m             [100%][0m

=================================== FAILURES ===================================
[31m[1m____________ TestNormalizationPipeline.test_ukrainian_name_pipeline ____________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:53: in test_ukrainian_name_pipeline
    [0m[94massert[39;49;00m normalization_result[[33m'[39;49;00m[33moriginal_text[39;49;00m[33m'[39;49;00m] == input_text[90m[39;49;00m
[1m[31mE   AssertionError: assert None == '–û–ª–µ–Ω–∞ –ü–µ—Ç—Ä—ñ–≤–Ω–∞'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m_____________ TestNormalizationPipeline.test_russian_name_pipeline _____________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:104: in test_russian_name_pipeline
    [0m[94massert[39;49;00m [33m'[39;49;00m[33mtoken_variants[39;49;00m[33m'[39;49;00m [95min[39;49;00m normalization_result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'token_variants' in NormalizationResult(normalized='–°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤', tokens=['–°–µ—Ä–≥–µ–π', '–ò–≤–∞–Ω–æ–≤'], trace=[TokenTrace(token='–°–µ—Ä–≥–µ–π', role='g...re_female': 0, 'score_male': 5, 'gap': 5}}], person_gender=None, gender_confidence=None, organizations=[], org_core='')[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m_________ TestNormalizationPipeline.test_mixed_language_text_pipeline __________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:127: in test_mixed_language_text_pipeline
    [0m[94massert[39;49;00m [33m'[39;49;00m[33mtoken_variants[39;49;00m[33m'[39;49;00m [95min[39;49;00m normalization_result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'token_variants' in NormalizationResult(normalized='John Smith And –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ', tokens=['John', 'Smith', 'And', '–Ü–≤–∞–Ω', '–ü–µ—Ç—Ä–µ–Ω–∫–æ'], tr...re_female': 0, 'score_male': 3, 'gap': 3}}], person_gender=None, gender_confidence=None, organizations=[], org_core='')[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m____________ TestNormalizationPipeline.test_compound_name_pipeline _____________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:160: in test_compound_name_pipeline
    [0m[94massert[39;49;00m [33m'[39;49;00m[33mtoken_variants[39;49;00m[33m'[39;49;00m [95min[39;49;00m normalization_result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'token_variants' in NormalizationResult(normalized='', tokens=[], trace=[], errors=[], language='ru', confidence=1.0, original_length=14, ..._core=[], organizations_core=[], persons=[], person_gender=None, gender_confidence=None, organizations=[], org_core='')[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m______________ TestNormalizationPipeline.test_empty_text_pipeline ______________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:225: in test_empty_text_pipeline
    [0m[94massert[39;49;00m normalization_result[[33m'[39;49;00m[33mtotal_variants[39;49;00m[33m'[39;49;00m] == [94m0[39;49;00m[90m[39;49;00m
[1m[31mE   assert None == 0[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m_____________ TestNormalizationPipeline.test_performance_pipeline ______________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:263: in test_performance_pipeline
    [0m[94massert[39;49;00m [33m'[39;49;00m[33mtoken_variants[39;49;00m[33m'[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'token_variants' in NormalizationResult(normalized='–û–ª–µ–∫—Å–∞–Ω–¥—Ä –ü–µ—Ç—Ä–µ–Ω–∫–æ', tokens=['–û–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ü–µ—Ç—Ä–µ–Ω–∫–æ'], trace=[TokenTrace(token='–û–ª–µ–∫—Å–∞...re_female': 0, 'score_male': 3, 'gap': 3}}], person_gender=None, gender_confidence=None, organizations=[], org_core='')[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m____________ TestNormalizationPipeline.test_morphology_integration _____________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:310: in test_morphology_integration
    [0m[94mfor[39;49;00m variants [95min[39;49;00m token_variants.values():[90m[39;49;00m
                    ^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'NoneType' object has no attribute 'values'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m__________ TestNormalizationPipeline.test_transliteration_integration __________[0m
[1m[31mtests/integration/test_normalization_pipeline.py[0m:331: in test_transliteration_integration
    [0m[94mfor[39;49;00m variants [95min[39;49;00m token_variants.values():[90m[39;49;00m
                    ^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'NoneType' object has no attribute 'values'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m src.ai_service.layers.variants.variant_generation_service:variant_generation_service.py:392 Ukrainian morphology analyzer not available: No module named 'src.ai_service.layers.variants.ukrainian_morphology'
[31m[1m____________________ test_orchestrator_with_metrics_service ____________________[0m
[1m[31mtests/unit/monitoring/test_metrics_basic.py[0m:85: in test_orchestrator_with_metrics_service
    [0m[94massert[39;49;00m result.success [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[1m[31mE    +  where False = UnifiedProcessingResult(original_text='John Doe', language='unknown', language_confidence=0.0, normalized_text='', tok..., decision=None, processing_time=0.00010204315185546875, success=False, errors=["'str' object has no attribute 'get'"]).success[0m
------------------------------ Captured log call -------------------------------
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.requests.total
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.requests.active
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.layer.validation
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.requests.failed
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.exceptions
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.requests.active
[33mWARNING [0m ai_service.monitoring.metrics_service:metrics_service.py:192 Recording value for unregistered metric: processing.total_time
[31m[1m__________ TestOrchestratorMetrics.test_successful_processing_metrics __________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:188: in test_successful_processing_metrics
    [0m[94massert[39;49;00m [96mlen[39;49;00m(successful_requests) > [94m0[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0 > 0[0m
[1m[31mE    +  where 0 = len([])[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m__________ TestOrchestratorMetrics.test_normalization_failure_metrics __________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:301: in test_normalization_failure_metrics
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.normalization.failed[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.normalization.failed' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.373896, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.373898, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.373896, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.373898, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x16fb7f6f0>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m____________ TestOrchestratorMetrics.test_variants_failure_metrics _____________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:319: in test_variants_failure_metrics
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.variants.failed[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.variants.failed' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.3812008, 'type': 'counter', ...}, 'proces...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.381203, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.3812008, 'type': 'counter', ...}, 'proces...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.381203, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x14a165eb0>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m___________ TestOrchestratorMetrics.test_embeddings_failure_metrics ____________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:337: in test_embeddings_failure_metrics
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.embeddings.failed[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.embeddings.failed' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.3880022, 'type': 'counter', ...}, 'proces...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.388003, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.3880022, 'type': 'counter', ...}, 'proces...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.388003, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x17834c6b0>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m____________ TestOrchestratorMetrics.test_decision_failure_metrics _____________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:351: in test_decision_failure_metrics
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.decision.failed[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.decision.failed' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.395467, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.395468, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.395467, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1757970080.395468, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x17834d150>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_____________ TestOrchestratorMetrics.test_slow_processing_metrics _____________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:377: in test_slow_processing_metrics
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.slow_requests[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.slow_requests' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1000.5, 'type': 'counter', ...}, 'processing.layer.s...timer', ...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1000.5, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1000.5, 'type': 'counter', ...}, 'processing.layer.s...timer', ...}, 'processing.requests.active': {'count': 2, 'labels': {}, 'timestamp': 1000.5, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x17ddbd150>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_________ TestOrchestratorMetrics.test_language_detection_distribution _________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:437: in test_language_detection_distribution
    [0m[94massert[39;49;00m counter_name [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'language_detection.detected.en' in {'processing.exceptions': {'count': 3, 'labels': {}, 'timestamp': 1757970080.415243, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 6, 'labels': {}, 'timestamp': 1757970080.415244, 'type': 'gauge', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 3, 'labels': {}, 'timestamp': 1757970080.415243, 'type': 'counter', ...}, 'process...}, 'processing.requests.active': {'count': 6, 'labels': {}, 'timestamp': 1757970080.415244, 'type': 'gauge', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x178ce37a0>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m________ TestOrchestratorMetrics.test_metrics_without_optional_services ________[0m
[1m[31mtests/unit/monitoring/test_orchestrator_metrics.py[0m:491: in test_metrics_without_optional_services
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mprocessing.requests.successful[39;49;00m[33m"[39;49;00m [95min[39;49;00m metrics_service.metrics[90m[39;49;00m
[1m[31mE   AssertionError: assert 'processing.requests.successful' in {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.425837, 'type': 'counter', ...}, 'process... 'processing.requests.failed': {'count': 1, 'labels': {}, 'timestamp': 1757970080.425836, 'type': 'counter', ...}, ...}[0m
[1m[31mE    +  where {'processing.exceptions': {'count': 1, 'labels': {}, 'timestamp': 1757970080.425837, 'type': 'counter', ...}, 'process... 'processing.requests.failed': {'count': 1, 'labels': {}, 'timestamp': 1757970080.425836, 'type': 'counter', ...}, ...} = <ai_service.monitoring.metrics_service.MetricsService object at 0x14a1a3230>.metrics[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m___________ TestOrchestratorService.test_process_basic_functionality ___________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:40: in test_process_basic_functionality
    [0m[94massert[39;49;00m result.success [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[1m[31mE    +  where False = UnifiedProcessingResult(original_text='Test text', language='unknown', language_confidence=0.0, normalized_text='', to...e, decision=None, processing_time=4.982948303222656e-05, success=False, errors=["'str' object has no attribute 'get'"]).success[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m src.ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_____________ TestOrchestratorService.test_process_with_cache_hit ______________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:53: in test_process_with_cache_hit
    [0mcached_result = UnifiedProcessingResult([90m[39;49;00m
[1m[31mE   TypeError: UnifiedProcessingResult.__init__() missing 3 required positional arguments: 'tokens', 'trace', and 'signals'[0m
[31m[1m_____________ TestOrchestratorService.test_process_with_cache_miss _____________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:80: in test_process_with_cache_miss
    [0m[94mwith[39;49;00m patch.object(orchestrator_service.cache_service, [33m'[39;49;00m[33mget[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_get, \
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'cache_service'. Did you mean: 'unicode_service'?[0m
[31m[1m_____________ TestOrchestratorService.test_process_with_embeddings _____________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:108: in test_process_with_embeddings
    [0mpatch.object(orchestrator_service.embedding_service, [33m'[39;49;00m[33mget_embeddings[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_embeddings:[90m[39;49;00m
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_service'. Did you mean: 'embeddings_service'?[0m
[31m[1m_____________ TestOrchestratorService.test_process_error_handling ______________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:142: in test_process_error_handling
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mUnicode service error[39;49;00m[33m"[39;49;00m [95min[39;49;00m result.errors[[94m0[39;49;00m][90m[39;49;00m
[1m[31mE   assert 'Unicode service error' in "'str' object has no attribute 'get'"[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m src.ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m__________________ TestOrchestratorService.test_process_batch __________________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:155: in test_process_batch
    [0mUnifiedProcessingResult([90m[39;49;00m
[1m[31mE   TypeError: UnifiedProcessingResult.__init__() missing 3 required positional arguments: 'tokens', 'trace', and 'signals'[0m
[31m[1m__________ TestOrchestratorService.test_process_batch_with_exceptions __________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:183: in test_process_batch_with_exceptions
    [0mUnifiedProcessingResult([90m[39;49;00m
[1m[31mE   TypeError: UnifiedProcessingResult.__init__() missing 3 required positional arguments: 'tokens', 'trace', and 'signals'[0m
[31m[1m______ TestOrchestratorService.test_search_similar_names_with_embeddings _______[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:209: in test_search_similar_names_with_embeddings
    [0m[94mwith[39;49;00m patch.object(orchestrator_service.embedding_service, [33m'[39;49;00m[33mfind_similar_texts[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_search:[90m[39;49;00m
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_service'. Did you mean: 'embeddings_service'?[0m
[31m[1m__________ TestOrchestratorService.test_search_similar_names_fallback __________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:239: in test_search_similar_names_fallback
    [0m[94mwith[39;49;00m patch.object(orchestrator_service.embedding_service, [33m'[39;49;00m[33mfind_similar_texts[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_search, \
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_service'. Did you mean: 'embeddings_service'?[0m
[31m[1m_____________ TestOrchestratorService.test_analyze_text_complexity _____________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:266: in test_analyze_text_complexity
    [0mpatch.object(orchestrator_service.signal_service, [33m'[39;49;00m[33mget_name_signals[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_signals:[90m[39;49;00m
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'signal_service'. Did you mean: 'signals_service'?[0m
[31m[1m______________ TestOrchestratorService.test_get_processing_stats _______________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:305: in test_get_processing_stats
    [0morchestrator_service.processing_stats[[33m'[39;49;00m[33mtotal_processed[39;49;00m[33m'[39;49;00m] = [94m10[39;49;00m[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_stats'[0m
[31m[1m___________________ TestOrchestratorService.test_clear_cache ___________________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:325: in test_clear_cache
    [0morchestrator_service.clear_cache()[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'clear_cache'[0m
[31m[1m___________________ TestOrchestratorService.test_reset_stats ___________________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:334: in test_reset_stats
    [0morchestrator_service.processing_stats[[33m'[39;49;00m[33mtotal_processed[39;49;00m[33m'[39;49;00m] = [94m5[39;49;00m[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_stats'[0m
[31m[1m_______________ TestOrchestratorService.test_generate_cache_key ________________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:347: in test_generate_cache_key
    [0mkey1 = orchestrator_service._generate_cache_key([33m"[39;49;00m[33mtest[39;49;00m[33m"[39;49;00m, [94mTrue[39;49;00m, [94mFalse[39;49;00m)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute '_generate_cache_key'[0m
[31m[1m__________________ TestOrchestratorService.test_update_stats ___________________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:360: in test_update_stats
    [0minitial_processed = orchestrator_service.processing_stats[[33m'[39;49;00m[33mtotal_processed[39;49;00m[33m'[39;49;00m][90m[39;49;00m
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_stats'[0m
[31m[1m___________ TestOrchestratorService.test_calculate_complexity_score ____________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:382: in test_calculate_complexity_score
    [0mscore = orchestrator_service._calculate_complexity_score([90m[39;49;00m
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute '_calculate_complexity_score'[0m
[31m[1m_______ TestOrchestratorService.test_generate_complexity_recommendations _______[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:395: in test_generate_complexity_recommendations
    [0mlow_recommendations = orchestrator_service._generate_complexity_recommendations([94m0.2[39;49;00m)[90m[39;49;00m
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute '_generate_complexity_recommendations'[0m
[31m[1m__________ TestOrchestratorService.test_force_reprocess_ignores_cache __________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:416: in test_force_reprocess_ignores_cache
    [0mcached_result = UnifiedProcessingResult([90m[39;49;00m
[1m[31mE   TypeError: UnifiedProcessingResult.__init__() missing 3 required positional arguments: 'tokens', 'trace', and 'signals'[0m
[31m[1m___________ TestOrchestratorService.test_orchestrator_initialization ___________[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:450: in test_orchestrator_initialization
    [0m[94massert[39;49;00m orchestrator.cache_service.max_size == [94m100[39;49;00m  [90m# From fixture[39;49;00m[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedOrchestrator' object has no attribute 'cache_service'. Did you mean: 'unicode_service'?[0m
[31m[1m_____ TestOrchestratorService.test_process_normalization_service_exception _____[0m
[1m[31mtests/unit/test_orchestrator_service_old.py[0m:531: in test_process_normalization_service_exception
    [0m[94massert[39;49;00m [96many[39;49;00m([33m'[39;49;00m[33mnormalization service error[39;49;00m[33m'[39;49;00m [95min[39;49;00m error.lower() [94mfor[39;49;00m error [95min[39;49;00m result.errors)[90m[39;49;00m
[1m[31mE   assert False[0m
[1m[31mE    +  where False = any(<generator object TestOrchestratorService.test_process_normalization_service_exception.<locals>.<genexpr> at 0x14ae98450>)[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m src.ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m______________ TestSmartFilterService.test_service_words_cleaning ______________[0m
[1m[31mtests/unit/test_smart_filter_service.py[0m:195: in test_service_words_cleaning
    [0m[96mself[39;49;00m.assertNotEqual(cleaned, text_with_service_words)[90m[39;49;00m
[1m[31mE   AssertionError: '–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é –ü–µ—Ç—Ä–æ–≤ –Ü–≤–∞–Ω' == '–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é –ü–µ—Ç—Ä–æ–≤ –Ü–≤–∞–Ω'[0m
------------------------------ Captured log call -------------------------------
[33mWARNING [0m ai_service.layers.smart_filter.smart_filter_service:smart_filter_service.py:479 _clean_service_words is deprecated - use context-aware analysis instead
[31m[1m___________ TestSmartFilterService.test_should_process_text_excluded ___________[0m
[1m[31mtests/unit/test_smart_filter_service.py[0m:59: in test_should_process_text_excluded
    [0m[96mself[39;49;00m.assertIn([33m"[39;49;00m[33m–∏—Å–∫–ª—é—á–µ–Ω[39;49;00m[33m"[39;49;00m, result.processing_recommendation)[90m[39;49;00m
[1m[31mE   AssertionError: '–∏—Å–∫–ª—é—á–µ–Ω' not found in 'Text excluded from processing (service information only)'[0m
[31m[1m________________ TestUnifiedOrchestrator.test_complete_pipeline ________________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:154: in test_complete_pipeline
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(result, UnifiedUnifiedProcessingResult)[90m[39;49;00m
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'UnifiedUnifiedProcessingResult' is not defined[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m______ TestUnifiedOrchestrator.test_normalization_flags_passed_correctly _______[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:193: in test_normalization_flags_passed_correctly
    [0m[94massert[39;49;00m call_args[[94m1[39;49;00m][[33m"[39;49;00m[33mremove_stop_words[39;49;00m[33m"[39;49;00m] [95mis[39;49;00m [94mFalse[39;49;00m[90m[39;49;00m
           ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m___________ TestUnifiedOrchestrator.test_optional_services_disabled ____________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:245: in test_optional_services_disabled
    [0m[94massert[39;49;00m result.success [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[1m[31mE    +  where False = UnifiedProcessingResult(original_text='Test', language='unknown', language_confidence=0.0, normalized_text='', tokens=...ne, decision=None, processing_time=3.62396240234375e-05, success=False, errors=["'str' object has no attribute 'get'"]).success[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_________________ TestUnifiedOrchestrator.test_error_handling __________________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:270: in test_error_handling
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mNormalization failed[39;49;00m[33m"[39;49;00m [95min[39;49;00m [96mstr[39;49;00m(result.errors)[90m[39;49;00m
[1m[31mE   assert 'Normalization failed' in '["\'str\' object has no attribute \'get\'"]'[0m
[1m[31mE    +  where '["\'str\' object has no attribute \'get\'"]' = str(["'str' object has no attribute 'get'"])[0m
[1m[31mE    +    where ["'str' object has no attribute 'get'"] = UnifiedProcessingResult(original_text='Test', language='unknown', language_confidence=0.0, normalized_text='', tokens=...e, decision=None, processing_time=0.0001900196075439453, success=False, errors=["'str' object has no attribute 'get'"]).errors[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_______________ TestUnifiedOrchestrator.test_performance_warning _______________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:289: in test_performance_warning
    [0m[94massert[39;49;00m result.success [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[1m[31mE    +  where False = UnifiedProcessingResult(original_text='Test', language='unknown', language_confidence=0.0, normalized_text='', tokens=..., decision=None, processing_time=0.00016689300537109375, success=False, errors=["'str' object has no attribute 'get'"]).success[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_________ TestUnifiedOrchestrator.test_backward_compatibility_methods __________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:296: in test_backward_compatibility_methods
    [0mresult = [94mawait[39;49;00m orchestrator.normalize_async([90m[39;49;00m
[1m[31msrc/ai_service/core/unified_orchestrator.py[0m:605: in normalize_async
    [0municode_normalized = unicode_result.get([33m"[39;49;00m[33mnormalized[39;49;00m[33m"[39;49;00m, sanitized)[90m[39;49;00m
                         ^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'str' object has no attribute 'get'[0m
------------------------------ Captured log call -------------------------------
[33mWARNING [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:585 normalize_async is deprecated. Use process() instead.
[31m[1m_______________ TestUnifiedOrchestrator.test_signals_integration _______________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:320: in test_signals_integration
    [0m[94massert[39;49;00m call_args [95mis[39;49;00m [95mnot[39;49;00m [94mNone[39;49;00m  [90m# Service was called[39;49;00m[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   assert None is not None[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m_______________ TestUnifiedOrchestrator.test_trace_preservation ________________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:334: in test_trace_preservation
    [0m[94massert[39;49;00m [96mlen[39;49;00m(result.trace) == [94m2[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0 == 2[0m
[1m[31mE    +  where 0 = len([])[0m
[1m[31mE    +    where [] = UnifiedProcessingResult(original_text='Test', language='unknown', language_confidence=0.0, normalized_text='', tokens=...e, decision=None, processing_time=0.0001552104949951172, success=False, errors=["'str' object has no attribute 'get'"]).trace[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m__________________ TestUnifiedOrchestrator.test_language_hint __________________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:347: in test_language_hint
    [0m[94massert[39;49;00m call_args[[94m1[39;49;00m][[33m"[39;49;00m[33mlanguage[39;49;00m[33m"[39;49;00m] == [33m"[39;49;00m[33men[39;49;00m[33m"[39;49;00m[90m[39;49;00m
           ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[31m[1m______________ TestUnifiedOrchestrator.test_result_serialization _______________[0m
[1m[31mtests/unit/test_unified_orchestrator.py[0m:358: in test_result_serialization
    [0m[94massert[39;49;00m data[[33m"[39;49;00m[33mnormalized_text[39;49;00m[33m"[39;49;00m] == [33m"[39;49;00m[33m–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' == '–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- –Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤[39;49;00m[90m[39;49;00m[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m ai_service.core.unified_orchestrator:unified_orchestrator.py:444 Processing failed: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/dariapavlova/Desktop/ai-service/src/ai_service/core/unified_orchestrator.py", line 240, in process
    unicode_normalized = unicode_result.get("normalized", context.sanitized_text)
                         ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
[33m=============================== warnings summary ===============================[0m
tests/unit/test_orchestrator_service_fixed.py::TestUnifiedOrchestrator::test_orchestrator_initialization
  /opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2247: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============================= slowest 25 durations =============================
0.32s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_language_detection_consistency
0.27s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_decision_input_creation
0.26s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_mixed_language_text_pipeline
0.15s call     tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_russian_name_pipeline
0.10s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_ukrainian_name_pipeline
0.09s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_russian_name_pipeline
0.08s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_compound_name_pipeline
0.08s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_error_resilience_pipeline
0.07s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_empty_text_pipeline
0.07s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_performance_pipeline
0.07s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_variant_generation_integration
0.07s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_transliteration_integration
0.06s setup    tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_morphology_integration
0.06s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_medium_risk_scenario
0.06s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_decision_engine_disabled
0.05s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_low_risk_scenario
0.05s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_high_risk_scenario
0.05s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_risk_level_determination
0.04s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_skip_scenario_smartfilter_false
0.04s setup    tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_decision_reasons_generation
0.04s setup    tests/unit/test_integration_morphology.py::TestMorphologyIntegration::test_advanced_normalization_pipeline
0.03s call     tests/unit/core/test_orchestrator_factory.py::TestOrchestratorFactory::test_service_initialization_mocking
0.02s call     tests/unit/core/test_orchestrator_factory.py::TestOrchestratorFactoryIntegration::test_factory_performance
0.02s call     tests/integration/test_orchestrator_decision_integration.py::TestOrchestratorDecisionIntegration::test_high_risk_scenario
0.01s call     tests/integration/test_normalization_pipeline.py::TestNormalizationPipeline::test_performance_pipeline
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_ukrainian_name_pipeline[0m - AssertionError: assert None == '–û–ª–µ–Ω–∞ –ü–µ—Ç—Ä—ñ–≤–Ω–∞'
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_russian_name_pipeline[0m - AssertionError: assert 'token_variants' in NormalizationResult(normalized='...
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_mixed_language_text_pipeline[0m - AssertionError: assert 'token_variants' in NormalizationResult(normalized='...
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_compound_name_pipeline[0m - AssertionError: assert 'token_variants' in NormalizationResult(normalized='...
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_empty_text_pipeline[0m - assert None == 0
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_performance_pipeline[0m - AssertionError: assert 'token_variants' in NormalizationResult(normalized='...
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_morphology_integration[0m - AttributeError: 'NoneType' object has no attribute 'values'
[31mFAILED[0m tests/integration/test_normalization_pipeline.py::[1mTestNormalizationPipeline::test_transliteration_integration[0m - AttributeError: 'NoneType' object has no attribute 'values'
[31mFAILED[0m tests/unit/monitoring/test_metrics_basic.py::[1mtest_orchestrator_with_metrics_service[0m - assert False is True
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_successful_processing_metrics[0m - assert 0 > 0
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_normalization_failure_metrics[0m - AssertionError: assert 'processing.normalization.failed' in {'processing.ex...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_variants_failure_metrics[0m - AssertionError: assert 'processing.variants.failed' in {'processing.excepti...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_embeddings_failure_metrics[0m - AssertionError: assert 'processing.embeddings.failed' in {'processing.excep...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_decision_failure_metrics[0m - AssertionError: assert 'processing.decision.failed' in {'processing.excepti...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_slow_processing_metrics[0m - AssertionError: assert 'processing.slow_requests' in {'processing.exception...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_language_detection_distribution[0m - AssertionError: assert 'language_detection.detected.en' in {'processing.exc...
[31mFAILED[0m tests/unit/monitoring/test_orchestrator_metrics.py::[1mTestOrchestratorMetrics::test_metrics_without_optional_services[0m - AssertionError: assert 'processing.requests.successful' in {'processing.exc...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_basic_functionality[0m - assert False is True
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_with_cache_hit[0m - TypeError: UnifiedProcessingResult.__init__() missing 3 required positional...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_with_cache_miss[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'cache_servic...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_with_embeddings[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_se...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_error_handling[0m - assert 'Unicode service error' in "'str' object has no attribute 'get'"
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_batch[0m - TypeError: UnifiedProcessingResult.__init__() missing 3 required positional...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_batch_with_exceptions[0m - TypeError: UnifiedProcessingResult.__init__() missing 3 required positional...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_search_similar_names_with_embeddings[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_se...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_search_similar_names_fallback[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'embedding_se...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_analyze_text_complexity[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'signal_servi...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_get_processing_stats[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_s...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_clear_cache[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'clear_cache'
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_reset_stats[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_s...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_generate_cache_key[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute '_generate_ca...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_update_stats[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'processing_s...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_calculate_complexity_score[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute '_calculate_c...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_generate_complexity_recommendations[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute '_generate_co...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_force_reprocess_ignores_cache[0m - TypeError: UnifiedProcessingResult.__init__() missing 3 required positional...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_orchestrator_initialization[0m - AttributeError: 'UnifiedOrchestrator' object has no attribute 'cache_servic...
[31mFAILED[0m tests/unit/test_orchestrator_service_old.py::[1mTestOrchestratorService::test_process_normalization_service_exception[0m - assert False
[31mFAILED[0m tests/unit/test_smart_filter_service.py::[1mTestSmartFilterService::test_service_words_cleaning[0m - AssertionError: '–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é –ü–µ—Ç—Ä–æ–≤ –Ü–≤–∞–Ω' == '–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç...
[31mFAILED[0m tests/unit/test_smart_filter_service.py::[1mTestSmartFilterService::test_should_process_text_excluded[0m - AssertionError: '–∏—Å–∫–ª—é—á–µ–Ω' not found in 'Text excluded from processing (ser...
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_complete_pipeline[0m - NameError: name 'UnifiedUnifiedProcessingResult' is not defined
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_normalization_flags_passed_correctly[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_optional_services_disabled[0m - assert False is True
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_error_handling[0m - assert 'Normalization failed' in '["\'str\' object has no attribute \'get\'"]'
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_performance_warning[0m - assert False is True
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_backward_compatibility_methods[0m - AttributeError: 'str' object has no attribute 'get'
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_signals_integration[0m - assert None is not None
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_trace_preservation[0m - assert 0 == 2
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_language_hint[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/unit/test_unified_orchestrator.py::[1mTestUnifiedOrchestrator::test_result_serialization[0m - AssertionError: assert '' == '–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤'
[31m==== [31m[1m49 failed[0m, [32m102 passed[0m, [33m1 skipped[0m, [33m1682 deselected[0m, [33m1 warning[0m[31m in 8.63s[0m[31m =====[0m
