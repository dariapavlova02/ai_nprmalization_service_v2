# Property-based тесты для нормализации имён

Этот пакет содержит property-based тесты, которые проверяют инварианты и свойства нормализации с помощью Hypothesis.

## Тестируемые свойства

### Идемпотентность
`normalize(normalize(x)) == normalize(x)`

Нормализация должна быть идемпотентной - повторное применение к уже нормализованному тексту не должно изменять результат.

### Детерминистичность
`normalize(x) == normalize(x)` (при одинаковых условиях)

Одинаковый вход должен всегда давать одинаковый результат.

### Charset-subset
Нормализация не должна добавлять новых символов в результат.

### Женский род
Женские имена должны сохранять женские суффиксы в результате.

### Разумная длина
Результат не должен быть значительно длиннее исходного текста (коэффициент ≤ 2.0).

## Запуск тестов

### Локально
```bash
# Все property тесты
pytest tests/property/ -v

# С настройками Hypothesis
pytest tests/property/ --hypothesis-max-examples=100

# Только определенные тесты
pytest tests/property/test_normalization_properties.py::test_idempotency -v
```

### С настройками производительности
```bash
# С проверкой производительности
pytest tests/property/ --strict-perf

# С подавлением health checks
pytest tests/property/ --suppress-health-checks
```

## Стратегии генерации данных

Тесты используют следующие стратегии Hypothesis:

- `name_text()` - Генерирует тексты с именами на разных языках
- `cyrillic_text()` - Кириллические тексты
- `latin_text()` - Латинские тексты
- `mixed_script_text()` - Тексты со смешанными скриптами

## Настройки

По умолчанию:
- `max_examples=50` - Максимум примеров для каждого теста
- `deadline=5000ms` - Максимальное время выполнения теста
- `max_failures=5` - Максимум неудачных попыток

## Отладка

Для отладки неудачных тестов:

```bash
# Показать воспроизводимый пример
pytest tests/property/ --hypothesis-show-statistics

# Сохранить неудачные примеры
pytest tests/property/ --hypothesis-seed=123456
```

## Расширение

Для добавления новых property тестов:

1. Создайте новую стратегию генерации данных
2. Напишите тест с декоратором `@given`
3. Добавьте проверку инварианта
4. Обновите документацию