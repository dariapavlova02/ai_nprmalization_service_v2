"""
Payment context triggers and keywords for building robust regex patterns.

These are used by PatternService to generate payment-context name extraction
patterns dynamically without hardcoding them in code.

Optimizations:
- Lazy loading to improve startup time
- LRU cache for regex compilation
- Deduplication of currency data
- Set-based lookups for better performance
"""

from functools import lru_cache
from typing import Dict, Set, List


def _regex_phrase(s: str) -> str:
    """Convert a plain phrase to a regex-safe variant (spaces -> \\s+)."""
    # Preserve cyrillic/latin letters and digits, escape other symbols except spaces
    import re

    s = s.strip()
    # Normalize smart apostrophes
    s = s.replace("’", "'")
    # Replace spaces with flexible whitespace
    s = re.sub(r"\s+", r"\\s+", s)
    # Escape regex metacharacters except backslashes introduced above
    # We escape hyphens and dots, colons as they appear in triggers sometimes
    s = s.replace(".", r"\.").replace("-", r"\-").replace(":", r"\:")
    return s


PAYMENT_TRIGGERS = {
    "ru": {
        "context": [
            "платеж",
            "оплата",
            "перевод",
            "перечисление",
            "зачисление",
            "списание",
            "деньги",
            "средства",
            "поступление",
            "получение",
            "платежи",
            "оплаты",
            "переводы",
            "перечисления",
            "зачисления",
            "списания",
            "деньги",
            "средства",
            "поступления",
            "получения",
            "возврат",
            "возмещение",
            "компенсация",
            "выплата",
            "доход",
            "расход",
            "отчисление",
            "взнос",
            "вклад",
            "депозит",
            "кредит",
            "займ",
            "ссуда",
            "долг",
            "задолженность",
            "погашение",
            "просрочка",
            "штраф",
            "пеня",
            "процент",
            "комиссия",
            "сбор",
            "налог",
            "пошлина",
            "тариф",
            "стоимость",
            "цена",
            "сумма",
            "размер",
            "объем",
            "количество",
            "возвраты",
            "возмещения",
            "компенсации",
            "выплаты",
            "доходы",
            "расходы",
            "отчисления",
            "взносы",
            "вклады",
            "депозиты",
            "кредиты",
            "займы",
            "ссуды",
            "долги",
            "задолженности",
            "погашения",
            "просрочки",
            "штрафы",
            "пени",
            "проценты",
            "комиссии",
            "сборы",
            "налоги",
            "пошлины",
            "тарифы",
            "стоимости",
            "цены",
            "суммы",
            "размеры",
            "объемы",
            "количества",
            "платежный",
            "платежная",
            "платежное",
            "платежные",
            "переводной",
            "переводная",
            "переводное",
            "переводные",
            "перечислительный",
            "перечислительная",
            "перечислительное",
            "перечислительные",
            "зачислительный",
            "зачислительная",
            "зачислительное",
            "зачислительные",
            "списательный",
            "списательная",
            "списательное",
            "списательные",
            "возвратный",
            "возвратная",
            "возвратное",
            "возвратные",
            "возместительный",
            "возместительная",
            "возместительное",
            "возместительные",
            "компенсационный",
            "компенсационная",
            "компенсационное",
            "компенсационные",
            "выплатной",
            "выплатная",
            "выплатное",
            "выплатные",
            "доходный",
            "доходная",
            "доходное",
            "доходные",
            "расходный",
            "расходная",
            "расходное",
            "расходные",
            "поступительный",
            "поступительная",
            "поступительное",
            "поступительные",
            "отчислительный",
            "отчислительная",
            "отчислительное",
            "отчислительные",
            "взносный",
            "взносная",
            "взносное",
            "взносные",
            "вкладной",
            "вкладная",
            "вкладное",
            "вкладные",
            "депозитный",
            "депозитная",
            "депозитное",
            "депозитные",
            "кредитный",
            "кредитная",
            "кредитное",
            "кредитные",
            "займовый",
            "займовая",
            "займовое",
            "займовые",
            "ссудный",
            "ссудная",
            "ссудное",
            "ссудные",
            "долговой",
            "долговая",
            "долговое",
            "долговые",
            "задолженностный",
            "задолженностная",
            "задолженностное",
            "задолженностные",
            "погасительный",
            "погасительная",
            "погасительное",
            "погасительные",
            "просроченный",
            "просроченная",
            "просроченное",
            "просроченные",
            "штрафной",
            "штрафная",
            "штрафное",
            "штрафные",
            "пенный",
            "пенная",
            "пенное",
            "пенные",
            "процентный",
            "процентная",
            "процентное",
            "процентные",
            "комиссионный",
            "комиссионная",
            "комиссионное",
            "комиссионные",
            "сборный",
            "сборная",
            "сборное",
            "сборные",
            "налоговый",
            "налоговая",
            "налоговое",
            "налоговые",
            "пошлинный",
            "пошлинная",
            "пошлинное",
            "пошлинные",
            "тарифный",
            "тарифная",
            "тарифное",
            "тарифные",
            "стоимостный",
            "стоимостная",
            "стоимостное",
            "стоимостные",
            "ценовой",
            "ценовая",
            "ценовое",
            "ценовые",
            "суммовой",
            "суммовая",
            "суммовое",
            "суммовые",
            "размерный",
            "размерная",
            "размерное",
            "размерные",
            "объемный",
            "объемная",
            "объемное",
            "объемные",
            "количественный",
            "количественная",
            "количественное",
            "количественные",
            "договор",
            "договора",
            "договоре",
            "договору",
            "договором",
            "договоры",
            "договоров",
            "договорах",
            "договорам",
            "договорами",
            "контракт",
            "контракта",
            "контракте",
            "контракту",
            "контрактом",
            "контракты",
            "контрактов",
            "контрактах",
            "контрактам",
            "контрактами",
            "соглашение",
            "соглашения",
            "соглашении",
            "соглашению",
            "соглашением",
            "соглашений",
            "соглашениях",
            "соглашениям",
            "соглашениями",
        ],
        "preps": [
            "от",
            "для",
            "в пользу",
            "на имя",
            "получатель",
            "отправитель",
            "получено от",
            "перевод от",
            "от кого",
            "кому",
            "для кого",
            "в пользу кого",
            "на имя кого",
            "получатель кого",
            "отправитель кого",
            "получено от кого",
            "перевод от кого",
            "отправил",
            "отправила",
            "отправило",
            "отправили",
            "получил",
            "получила",
            "получило",
            "получили",
            "перевел",
            "перевела",
            "перевело",
            "перевели",
            "перечислил",
            "перечислила",
            "перечислило",
            "перечислили",
            "зачислил",
            "зачислила",
            "зачислило",
            "зачислили",
            "списал",
            "списала",
            "списало",
            "списали",
            "возвратил",
            "возвратила",
            "возвратило",
            "возвратили",
            "возместил",
            "возместила",
            "возместило",
            "возместили",
            "компенсировал",
            "компенсировала",
            "компенсировало",
            "компенсировали",
            "выплатил",
            "выплатила",
            "выплатило",
            "выплатили",
            "получил доход",
            "получила доход",
            "получило доход",
            "получили доход",
            "понес расход",
            "понесла расход",
            "понесло расход",
            "понесли расход",
            "поступил",
            "поступила",
            "поступило",
            "поступили",
            "отчислил",
            "отчислила",
            "отчислило",
            "отчислили",
            "внес",
            "внесла",
            "внесло",
            "внесли",
            "вложил",
            "вложила",
            "вложило",
            "вложили",
            "депонировал",
            "депонировала",
            "депонировало",
            "депонировали",
            "кредитовал",
            "кредитовала",
            "кредитовало",
            "кредитовали",
            "займовал",
            "займовала",
            "займовало",
            "займовали",
            "ссудовал",
            "ссудовала",
            "ссудовало",
            "ссудовали",
            "задолжал",
            "задолжала",
            "задолжало",
            "задолжали",
            "погасил",
            "погасила",
            "погасило",
            "погасили",
            "просрочил",
            "просрочила",
            "просрочило",
            "просрочили",
            "оштрафовал",
            "оштрафовала",
            "оштрафовало",
            "оштрафовали",
            "начислил пеню",
            "начислила пеню",
            "начислило пеню",
            "начислили пеню",
            "начислил процент",
            "начислила процент",
            "начислило процент",
            "начислили процент",
            "взял комиссию",
            "взяла комиссию",
            "взяло комиссию",
            "взяли комиссию",
            "взял сбор",
            "взяла сбор",
            "взяло сбор",
            "взяли сбор",
            "взял налог",
            "взяла налог",
            "взяло налог",
            "взяли налог",
            "взял пошлину",
            "взяла пошлину",
            "взяло пошлину",
            "взяли пошлину",
            "установил тариф",
            "установила тариф",
            "установило тариф",
            "установили тариф",
            "установил стоимость",
            "установила стоимость",
            "установило стоимость",
            "установили стоимость",
            "установил цену",
            "установила цену",
            "установило цену",
            "установили цену",
            "установил сумму",
            "установила сумму",
            "установило сумму",
            "установили сумму",
            "установил размер",
            "установила размер",
            "установило размер",
            "установили размер",
            "установил объем",
            "установила объем",
            "установило объем",
            "установили объем",
            "установил количество",
            "установила количество",
            "установило количество",
            "установили количество",
        ],
        "currencies": [],  # Populated by lazy loading
    },
    "uk": {
        "context": [
            "платіж",
            "оплата",
            "переказ",
            "перерахування",
            "зарахування",
            "списання",
            "кошти",
            "гроші",
            "надходження",
            "отримання",
            "платежі",
            "оплати",
            "перекази",
            "перерахування",
            "зарахування",
            "списання",
            "кошти",
            "гроші",
            "надходження",
            "отримання",
            "повернення",
            "відшкодування",
            "компенсація",
            "виплата",
            "дохід",
            "витрата",
            "відчислення",
            "внесок",
            "вклад",
            "депозит",
            "кредит",
            "позика",
            "суда",
            "борг",
            "заборгованість",
            "погашення",
            "прострочення",
            "штраф",
            "пеня",
            "відсоток",
            "комісія",
            "збір",
            "податок",
            "мито",
            "тариф",
            "вартість",
            "ціна",
            "сума",
            "розмір",
            "обсяг",
            "кількість",
            "повернення",
            "відшкодування",
            "компенсації",
            "виплати",
            "доходи",
            "витрати",
            "відчислення",
            "внески",
            "вклади",
            "депозити",
            "кредити",
            "позики",
            "суди",
            "борги",
            "заборгованості",
            "погашення",
            "прострочення",
            "штрафи",
            "пені",
            "відсотки",
            "комісії",
            "збори",
            "податки",
            "мита",
            "тарифи",
            "вартості",
            "ціни",
            "суми",
            "розміри",
            "обсяги",
            "кількості",
            "платежний",
            "платежна",
            "платежне",
            "платежні",
            "переказний",
            "переказна",
            "переказне",
            "переказні",
            "перерахувальний",
            "перерахувальна",
            "перерахувальне",
            "перерахувальні",
            "зарахувальний",
            "зарахувальна",
            "зарахувальне",
            "зарахувальні",
            "списаний",
            "списана",
            "списане",
            "списані",
            "повертальний",
            "повертальна",
            "повертальне",
            "повертальні",
            "відшкодувальний",
            "відшкодувальна",
            "відшкодувальне",
            "відшкодувальні",
            "компенсаційний",
            "компенсаційна",
            "компенсаційне",
            "компенсаційні",
            "виплатний",
            "виплатна",
            "виплатне",
            "виплатні",
            "доходний",
            "доходна",
            "доходне",
            "доходні",
            "витратний",
            "витратна",
            "витратне",
            "витратні",
            "надходження",
            "надходження",
            "надходження",
            "надходження",
            "відчислення",
            "відчислення",
            "відчислення",
            "відчислення",
            "внесковий",
            "внескова",
            "внескове",
            "внескові",
            "вкладний",
            "вкладна",
            "вкладне",
            "вкладні",
            "депозитний",
            "депозитна",
            "депозитне",
            "депозитні",
            "кредитний",
            "кредитна",
            "кредитне",
            "кредитні",
            "позиковий",
            "позикова",
            "позикове",
            "позикові",
            "судний",
            "судна",
            "судне",
            "судні",
            "борговий",
            "боргова",
            "боргове",
            "боргові",
            "заборгованостний",
            "заборгованостна",
            "заборгованостне",
            "заборгованостні",
            "погасительний",
            "погасительна",
            "погасительне",
            "погасительні",
            "прострочений",
            "прострочена",
            "прострочене",
            "прострочені",
            "штрафний",
            "штрафна",
            "штрафне",
            "штрафні",
            "пенний",
            "пенна",
            "пенне",
            "пенні",
            "відсотковий",
            "відсоткова",
            "відсоткове",
            "відсоткові",
            "комісійний",
            "комісійна",
            "комісійне",
            "комісійні",
            "збірний",
            "збірна",
            "збірне",
            "збірні",
            "податковий",
            "податкова",
            "податкове",
            "податкові",
            "митний",
            "митна",
            "митне",
            "митні",
            "тарифний",
            "тарифна",
            "тарифне",
            "тарифні",
            "вартісний",
            "вартісна",
            "вартісне",
            "вартісні",
            "ціновий",
            "цінова",
            "цінове",
            "цінові",
            "сумовий",
            "сумова",
            "сумове",
            "сумові",
            "розмірний",
            "розмірна",
            "розмірне",
            "розмірні",
            "обсяговий",
            "обсягова",
            "обсягове",
            "обсягові",
            "кількісний",
            "кількісна",
            "кількісне",
            "кількісні",
            "договір",
            "договора",
            "договорі",
            "договору",
            "договором",
            "договори",
            "договорів",
            "договорах",
            "договорам",
            "договорами",
            "контракт",
            "контракта",
            "контракті",
            "контракту",
            "контрактом",
            "контракти",
            "контрактів",
            "контрактах",
            "контрактам",
            "контрактами",
            "угода",
            "угоди",
            "угоді",
            "угоду",
            "угодою",
            "угод",
            "угодах",
            "угодам",
            "угодами",
            "абон",
            "абонент",
            "абонента",
            "абоненте",
            "абоненту",
            "абонентом",
            "абоненты",
            "абонентов",
            "абонентах",
            "абонентам",
            "абонентами",
            "абонентский",
            "абонентская",
            "абонентское",
            "абонентские",
            "абонентської",
            "абонентська",
            "абонентського",
            "абонентські",
            "абонементы",
            "абонементов",
            "абонемент",
            "абонемента",
            "абонементе",
            "абонементу",
            "абонементом",
            "послуг",
            "послуга",
            "послуги",
            "послугу",
            "послугою",
            "послугах",
            "послугам",
            "послугами",
            "послуги",
            "услуг",
            "услуга",
            "услуги",
            "услугу",
            "услугой",
            "услугах",
            "услугам",
            "услугами",
            "телекомунікаційні",
            "телекомунікаційний",
            "телекомунікаційна",
            "телекомунікаційне",
            "телекомунікаційних",
            "телекомунікаційними",
            "телекоммуникационные",
            "телекоммуникационный",
            "телекоммуникационная",
            "телекоммуникационное",
            "телекоммуникационных",
            "телекоммуникационными",
        ],
        "preps": [
            "від",
            "для",
            "на користь",
            "на ім'я",
            "на імʼя",
            "одержувач",
            "відправник",
            "отримано від",
            "переказ від",
            "від кого",
            "кому",
            "для кого",
            "на користь кого",
            "на ім'я кого",
            "на імʼя кого",
            "одержувач кого",
            "відправник кого",
            "отримано від кого",
            "переказ від кого",
            "відправив",
            "відправила",
            "відправило",
            "відправили",
            "отримав",
            "отримала",
            "отримало",
            "отримали",
            "переказав",
            "переказала",
            "переказало",
            "переказали",
            "перерахував",
            "перерахувала",
            "перерахувало",
            "перерахували",
            "зарахував",
            "зарахувала",
            "зарахувало",
            "зарахували",
            "списав",
            "списала",
            "списало",
            "списали",
            "повернув",
            "повернула",
            "повернуло",
            "повернули",
            "відшкодував",
            "відшкодувала",
            "відшкодувало",
            "відшкодували",
            "компенсував",
            "компенсувала",
            "компенсувало",
            "компенсували",
            "виплатив",
            "виплатила",
            "виплатило",
            "виплатили",
            "отримав дохід",
            "отримала дохід",
            "отримало дохід",
            "отримали дохід",
            "понес витрату",
            "понесла витрату",
            "понесло витрату",
            "понесли витрату",
            "надійшов",
            "надійшла",
            "надійшло",
            "надійшли",
            "відчислив",
            "відчислила",
            "відчислило",
            "відчислили",
            "вніс",
            "внесла",
            "внесло",
            "внесли",
            "вклав",
            "вклала",
            "вклало",
            "вклали",
            "депонував",
            "депонувала",
            "депонувало",
            "депонували",
            "кредитував",
            "кредитувала",
            "кредитувало",
            "кредитували",
            "позичав",
            "позичала",
            "позичало",
            "позичали",
            "судував",
            "судувала",
            "судувало",
            "судували",
            "заборгував",
            "заборгувала",
            "заборгувало",
            "заборгували",
            "погасив",
            "погасила",
            "погасило",
            "погасили",
            "прострочив",
            "прострочила",
            "прострочило",
            "прострочили",
            "оштрафував",
            "оштрафувала",
            "оштрафувало",
            "оштрафували",
            "нарахував пеню",
            "нарахувала пеню",
            "нарахувало пеню",
            "нарахували пеню",
            "нарахував відсоток",
            "нарахувала відсоток",
            "нарахувало відсоток",
            "нарахували відсоток",
            "взяв комісію",
            "взяла комісію",
            "взяло комісію",
            "взяли комісію",
            "взяв збір",
            "взяла збір",
            "взяло збір",
            "взяли збір",
            "взяв податок",
            "взяла податок",
            "взяло податок",
            "взяли податок",
            "взяв мито",
            "взяла мито",
            "взяло мито",
            "взяли мито",
            "встановив тариф",
            "встановила тариф",
            "встановило тариф",
            "встановили тариф",
            "встановив вартість",
            "встановила вартість",
            "встановило вартість",
            "встановили вартість",
            "встановив ціну",
            "встановила ціну",
            "встановило ціну",
            "встановили ціну",
            "встановив суму",
            "встановила суму",
            "встановило суму",
            "встановили суму",
            "встановив розмір",
            "встановила розмір",
            "встановило розмір",
            "встановили розмір",
            "встановив обсяг",
            "встановила обсяг",
            "встановило обсяг",
            "встановили обсяг",
            "встановив кількість",
            "встановила кількість",
            "встановило кількість",
            "встановили кількість",
        ],
        "currencies": [],  # Populated by lazy loading
    },
    "en": {
        "context": [
            "payment",
            "transfer",
            "remittance",
            "credit",
            "debit",
            "funds",
            "money",
            "incoming",
            "received",
            "payments",
            "transfers",
            "remittances",
            "credits",
            "debits",
            "funds",
            "money",
            "incoming",
            "received",
            "refund",
            "reimbursement",
            "compensation",
            "payout",
            "income",
            "expense",
            "deduction",
            "contribution",
            "deposit",
            "loan",
            "debt",
            "liability",
            "repayment",
            "overdue",
            "penalty",
            "interest",
            "commission",
            "fee",
            "tax",
            "duty",
            "tariff",
            "cost",
            "price",
            "amount",
            "size",
            "volume",
            "quantity",
            "refunds",
            "reimbursements",
            "compensations",
            "payouts",
            "incomes",
            "expenses",
            "deductions",
            "contributions",
            "deposits",
            "loans",
            "debts",
            "liabilities",
            "repayments",
            "overdues",
            "penalties",
            "interests",
            "commissions",
            "fees",
            "taxes",
            "duties",
            "tariffs",
            "costs",
            "prices",
            "amounts",
            "sizes",
            "volumes",
            "quantities",
            "payment",
            "payment",
            "payment",
            "payments",
            "transfer",
            "transfer",
            "transfer",
            "transfers",
            "remittance",
            "remittance",
            "remittance",
            "remittances",
            "credit",
            "credit",
            "credit",
            "credits",
            "debit",
            "debit",
            "debit",
            "debits",
            "fund",
            "fund",
            "fund",
            "funds",
            "money",
            "money",
            "money",
            "money",
            "incoming",
            "incoming",
            "incoming",
            "incoming",
            "received",
            "received",
            "received",
            "received",
            "refund",
            "refund",
            "refund",
            "refunds",
            "reimbursement",
            "reimbursement",
            "reimbursement",
            "reimbursements",
            "compensation",
            "compensation",
            "compensation",
            "compensations",
            "payout",
            "payout",
            "payout",
            "payouts",
            "income",
            "income",
            "income",
            "incomes",
            "expense",
            "expense",
            "expense",
            "expenses",
            "deduction",
            "deduction",
            "deduction",
            "deductions",
            "contribution",
            "contribution",
            "contribution",
            "contributions",
            "deposit",
            "deposit",
            "deposit",
            "deposits",
            "loan",
            "loan",
            "loan",
            "loans",
            "debt",
            "debt",
            "debt",
            "debts",
            "liability",
            "liability",
            "liability",
            "liabilities",
            "repayment",
            "repayment",
            "repayment",
            "repayments",
            "overdue",
            "overdue",
            "overdue",
            "overdues",
            "penalty",
            "penalty",
            "penalty",
            "penalties",
            "interest",
            "interest",
            "interest",
            "interests",
            "commission",
            "commission",
            "commission",
            "commissions",
            "fee",
            "fee",
            "fee",
            "fees",
            "tax",
            "tax",
            "tax",
            "taxes",
            "duty",
            "duty",
            "duty",
            "duties",
            "tariff",
            "tariff",
            "tariff",
            "tariffs",
            "cost",
            "cost",
            "cost",
            "costs",
            "price",
            "price",
            "price",
            "prices",
            "amount",
            "amount",
            "amount",
            "amounts",
            "size",
            "size",
            "size",
            "sizes",
            "volume",
            "volume",
            "volume",
            "volumes",
            "quantity",
            "quantity",
            "quantity",
            "quantities",
        ],
        "preps": [
            "from",
            "for",
            "to",
            "on behalf of",
            "beneficiary",
            "recipient",
            "payer",
            "sender",
            "received from",
            "from whom",
            "to whom",
            "for whom",
            "on behalf of whom",
            "beneficiary of",
            "recipient of",
            "payer of",
            "sender of",
            "received from whom",
            "sent",
            "sent",
            "sent",
            "sent",
            "received",
            "received",
            "received",
            "received",
            "transferred",
            "transferred",
            "transferred",
            "transferred",
            "remitted",
            "remitted",
            "remitted",
            "remitted",
            "credited",
            "credited",
            "credited",
            "credited",
            "debited",
            "debited",
            "debited",
            "debited",
            "refunded",
            "refunded",
            "refunded",
            "refunded",
            "reimbursed",
            "reimbursed",
            "reimbursed",
            "reimbursed",
            "compensated",
            "compensated",
            "compensated",
            "compensated",
            "paid out",
            "paid out",
            "paid out",
            "paid out",
            "received income",
            "received income",
            "received income",
            "received income",
            "incurred expense",
            "incurred expense",
            "incurred expense",
            "incurred expense",
            "incoming",
            "incoming",
            "incoming",
            "incoming",
            "deducted",
            "deducted",
            "deducted",
            "deducted",
            "contributed",
            "contributed",
            "contributed",
            "contributed",
            "deposited",
            "deposited",
            "deposited",
            "deposited",
            "loaned",
            "loaned",
            "loaned",
            "loaned",
            "borrowed",
            "borrowed",
            "borrowed",
            "borrowed",
            "lent",
            "lent",
            "lent",
            "lent",
            "owed",
            "owed",
            "owed",
            "owed",
            "repaid",
            "repaid",
            "repaid",
            "repaid",
            "overdue",
            "overdue",
            "overdue",
            "overdue",
            "penalized",
            "penalized",
            "penalized",
            "penalized",
            "charged interest",
            "charged interest",
            "charged interest",
            "charged interest",
            "charged commission",
            "charged commission",
            "charged commission",
            "charged commission",
            "charged fee",
            "charged fee",
            "charged fee",
            "charged fee",
            "charged tax",
            "charged tax",
            "charged tax",
            "charged tax",
            "charged duty",
            "charged duty",
            "charged duty",
            "charged duty",
            "set tariff",
            "set tariff",
            "set tariff",
            "set tariff",
            "set cost",
            "set cost",
            "set cost",
            "set cost",
            "set price",
            "set price",
            "set price",
            "set price",
            "set amount",
            "set amount",
            "set amount",
            "set amount",
            "set size",
            "set size",
            "set size",
            "set size",
            "set volume",
            "set volume",
            "set volume",
            "set volume",
            "set quantity",
            "set quantity",
            "set quantity",
            "set quantity",
        ],
        "currencies": [],  # Populated by lazy loading
    },
}


# Lazy-loaded and cached currency data to reduce duplication
@lru_cache(maxsize=None)
def _get_base_currencies() -> Dict[str, List[str]]:
    """Get base currency data without duplication."""
    return {
        "usd": ["usd", "$", "доллар", "долар", "dollar", "dollars", "долларов", "долларе", "долларах", "долларом", "долларами", "доллару", "долларам"],
        "eur": ["eur", "€", "евро", "євро", "euro", "euros", "евра", "евре", "евру", "евром", "еврами", "еврах", "еврам"],
        "uah": ["uah", "₴", "грн", "гривна", "гривня", "hryvnia", "hryvnias", "гривны", "гривні", "гривен", "гривень", "гривне", "гривнях", "гривной", "гривнею", "гривнями", "гривну", "гривням"],
        "rub": ["rub", "₽", "руб", "рубль", "ruble", "rubles", "рубли", "рублі", "рублей", "рублів", "рубля", "рубле", "рублях", "рублем", "рублями", "рублю", "рублям"]
    }


@lru_cache(maxsize=None)
def _get_expanded_currencies(language: str) -> List[str]:
    """Get expanded currency list for a language without duplication."""
    base = _get_base_currencies()
    currencies = []

    # Add base currency symbols and codes
    for currency_list in base.values():
        currencies.extend(currency_list)

    # Add language-specific expanded forms
    if language in ["ru", "uk"]:
        currencies.extend([
            "доллар сша", "долар сша", "долары сша", "доллары сша", "долларов сша", "доларів сша",
            "американский доллар", "американський долар", "американские доллары", "американські долари",
            "евро зоны", "євро зони", "европейский евро", "європейський євро",
            "украинская гривна", "українська гривня", "украинские гривны", "українські гривні",
            "российский рубль", "російський рубль", "российские рубли", "російські рублі"
        ])
    elif language == "en":
        currencies.extend([
            "dollar usa", "dollars usa", "euro zone", "euros zone",
            "ukrainian hryvnia", "ukrainian hryvnias", "russian ruble", "russian rubles",
            "american dollar", "american dollars", "european euro", "european euros",
            "gbp", "£", "pound", "pounds"
        ])

    return currencies


@lru_cache(maxsize=32)
def build_trigger_regex(language: str) -> dict:
    """Build regex patterns for payment triggers with caching."""
    data = get_payment_triggers(language)
    return {
        key: "(?:" + "|".join(_regex_phrase(w) for w in data.get(key, [])) + ")"
        for key in ("context", "preps", "currencies")
    }


@lru_cache(maxsize=32)
def get_trigger_sets(language: str) -> Dict[str, Set[str]]:
    """Get payment triggers as sets for fast membership testing."""
    data = PAYMENT_TRIGGERS.get(language, {})
    return {
        "context": set(data.get("context", [])),
        "preps": set(data.get("preps", [])),
        "currencies": set(_get_expanded_currencies(language))
    }


@lru_cache(maxsize=32)
def get_payment_triggers(language: str) -> Dict[str, List[str]]:
    """Get payment triggers with lazy-loaded currencies."""
    data = PAYMENT_TRIGGERS.get(language, {}).copy()
    # Populate currencies lazily
    if not data.get("currencies"):
        data["currencies"] = _get_expanded_currencies(language)
    return data
